version: 2

models:

  # ============================================================
  # dim_customer_profile
  # ============================================================
  - name: dim_customer_profile
    description: "Combined customer identity + behavior dimension (profile-level attributes)."
    config:
      tags: ["dimension", "customer"]

    columns:
      - name: customer_profile_sk
        description: "Surrogate key for the customer profile dimension"
        tests:
          - unique
          - not_null

      - name: customer_id
        description: "Business key for customer"
        tests:
          - not_null
          - relationships:
              to: ref('snp_customers')
              field: customer_id

      - name: first_name
        description: "Customer first name"
        tests:
          - not_null

      - name: last_name
        description: "Customer last name"
        tests:
          - not_null

      - name: email
        description: "Customer email address"

      - name: phone
        description: "Customer phone number"

      - name: age
        description: "Customer age"

      - name: age_group
        description: "Derived age segment"
        tests:
          - accepted_values:
              values: ["Minor", "Young Adult", "Adult", "Mid-Life", "Senior"]

      - name: gender
        description: "Customer gender"
        tests:
          - accepted_values:
              values: ["M", "F", "Other"]

      - name: loyalty_points
        description: "Customer loyalty score"

      - name: loyalty_tier
        description: "Tier derived from loyalty points"
        tests:
          - accepted_values:
              values: ["Bronze", "Silver", "Gold", "Platinum"]

      - name: marketing_opt_in
        description: "Whether customer opted into marketing"
        tests:
          - not_null

      - name: is_vip_member
        description: "VIP membership flag"
        tests:
          - not_null

      - name: preferred_scare_level
        description: "Customer's preferred scare level"

      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null

      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null


  # ============================================================
  # dim_customer_location
  # ============================================================
  - name: dim_customer_location
    description: "Customer address and geographic attributes."
    config:
      tags: ["dimension", "customer", "location"]

    columns:
      - name: customer_location_sk
        description: "Surrogate key for the customer location dimension"
        tests:
          - unique
          - not_null

      - name: customer_id
        description: "Business-level customer identifier"
        tests:
          - not_null
          - relationships:
              to: ref('snp_customers')
              field: customer_id

      - name: address
        description: "Street address"

      - name: city
        description: "City of residence"

      - name: state
        description: "State code (2-character)"

      - name: state_name
        description: "Full state name"

      - name: zip_code
        description: "Zip/postal code"

      - name: registration_date
        description: "Date customer registered"
        tests:
          - not_null

      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null

      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null


  # ============================================================
  # dim_customer_segments
  # ============================================================
  - name: dim_customer_segments
    description: "Marketing segmentation, customer value, lifecycle, retention risk."
    config:
      tags: ["dimension", "segment", "customer"]

    columns:
      - name: segment_sk
        description: "Surrogate key for the segment dimension"
        tests:
          - unique
          - not_null

      - name: customer_id
        description: "Customer business key"
        tests:
          - not_null
          - relationships:
              to: ref('snp_customers')
              field: customer_id

      - name: customer_value_segment
        description: "Value-based segmentation"
        tests:
          - accepted_values:
              values: ["High Value", "Medium Value", "Low Value"]

      - name: customer_lifecycle_stage
        description: "Lifecycle stage segmentation"

      - name: retention_risk_level
        description: "Risk to churn"

      - name: upsell_opportunity
        description: "Recommended upsell category"

      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null

      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null
